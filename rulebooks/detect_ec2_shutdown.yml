---

- name: Detect EC2 Shutdown
  host: localhost
  sources:
    - ansible.eda.aws_cloudtrail:
      access_key: "{{ lookup('env', 'aws_access_key_id') }}"
      secret_key: "{{ lookup('env', 'aws_secret_accee_key') }}"
      region: 'us-east-2'

  rules:
    - name: Monitor StopInstances Events
      condition: event.CloudTrailEvent.eventName == "StopInstances"
      action:
        run_playbook:
          name: ec2_shutdown_demo.yml
      